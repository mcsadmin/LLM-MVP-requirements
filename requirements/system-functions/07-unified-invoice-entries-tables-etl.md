# Unified Invoice Entries Tables & ETL

**Sequence:** 07  
**Source:** MVP Requirements / Unified Invoice Entries Tables & ETL #SystemFunction  
**ClickUp Page ID:** 8cp80ab-4455  
**Last Updated:** 2025-11-26  
**Tags:** #SystemFunction #Invoices

---

# 1\. **Initial Table**
### 1\. Combine Client User's invoice data from Promis and non-Promis extraction and pre-processing as a basis for subsequent processing
1. WHY: combining data from these two sources is a necessary pre-cursor to all subsequent processing.
2. WHAT:
    1. See 'Requirements' section of [Initial Unified Invoice Entries Table](https://hackmd.io/ZlvvVv-uTkekmM2NJgWNsA?both).
        1. This also contains a full specification for meeting the requirements via spreadsheet operations. However, note that this assumes data processing on a per-Client User basis, whereas MVP has tables containing all Client Users' data.

# 2\. Data Cleaning (ETL)
### 1\. Prepare the Client User's invoice data for de-duplication and subsequent presentation to Client User for clearing-related actions
1. WHY: preliminary steps are necessary before the data can be de-duplicated and presented.
2. WHAT:
    1. See 'Requirements' section of [Data Cleaning (ETL)](https://hackmd.io/HcLufMa_TkusW3Kw85K12A).
        1. This also contains a full specification for meeting the requirements via a Python script. However, note that this assumes data processing on a per-Client User basis, whereas MVP has tables containing all Client Users' data.
    2. See 'Requirements' sections of [Non-Promis Data Extraction & Pre-Processing](https://hackmd.io/@mcsdocs/r13lHinfel) and [Promis Data Extraction & Pre-Processing](https://hackmd.io/@mcsdocs/S18NHonzxl) for certain filters which are also applied here for MVP.
### 9\. Additional testing notes
*   Trace Promis and non-Promis timestamps through ETL and ensure all behaviour is correct.
    *   Paul noted that invoices\_staging should be auto-generating the created\_at and updated\_at timestamps, and these should be being applied to both Promis and non-Promis data within this table.
*   Confirm that if Amount Due = Â£0.00, then Payment Status is always automatically updated to 'Paid'
*   Ensure that invoices\_staging is being populated with organization\_id field from organizations for non-Promis data

#### 10\. Post-MVP notes
*   Sanity checking of Amount Due and Due Date
    *   NB that these are slightly different for Promis and non-Promis data - refer to v1.2 pre-processing documentation
*   Confirm possible update to pro forma identifier string filter: might stop including 'this is not a VAT invoice'. See [here](https://www.getvergo.com/define/interim-payment-certificate) for source, also [here](https://www.accountingweb.co.uk/tax/business-tax/when-is-an-invoice-not-a-vat-invoice) for possibly relevant further info. NB that if decided that need to retain, should also include 'this is not a tax invoice' and 'this is not a VAT/tax invoice'. This (and other changes) to filtering can be made flexibly. Might need to consult with Donna.
# 3\. Duplicate Removal and Reporting
### 1\. Remove and report on any duplicates that may have arisen within and across each Client User's Promis and non-Promis invoice data
1. WHY: De-duplication is necessary to present a clean 'single source of truth' to each Client User, and enable correct clearing analysis. Reporting is necessary to facilitate data QA and onward front-office actions.
2. WHAT:
    1. See 'Requirements' section of [Duplicate Removal (automated)](https://hackmd.io/xCbVYX5QRrutDo5Am-ICdw).
        1. This also contains a full specification for meeting the requirements via a Python script. However, note that this assumes data processing on a per-Client User basis, whereas MVP has tables containing all Client Users' data.
    2. See 'Requirements' section of [Duplicates Report](https://hackmd.io/jcOtMR7gTsGOt-R5_mckPA).
        1. This also contains documentation on the report generated by the de-duplication Python script. However, note that this assumes data processing on a per-Client User basis, whereas MVP has tables containing all Client Users' data.

---

**Document Metadata:**
- **Created:** 2025-06-25
- **Sequence Number:** 07
- **Source System:** ClickUp
- **Workspace ID:** 9015918923
- **Doc ID:** 8cp80ab-3995
- **Page ID:** 8cp80ab-4455
